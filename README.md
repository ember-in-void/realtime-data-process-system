# realtime-data-process-system

## О проекте

**realtime-data-process-system** — это высокопроизводительная система для обработки и агрегации рыночных данных в режиме реального времени. Приложение предназначено для сбора цен с нескольких криптовалютных бирж, их кэширования, агрегации и предоставления REST API для получения последних, средних, минимальных и максимальных цен, а также статистики по выбранным торговым парам.

Проект реализует:
- Многопоточную обработку входящих потоков данных (concurrency patterns: fan-in, fan-out, worker pool, generator).
- Кэширование актуальных цен в Redis для ускоренного доступа.
- Агрегацию и хранение минутных статистик (average, min, max) в PostgreSQL.
- REST API для получения рыночных данных и управления режимом работы.
- Гибкую конфигурацию через файл.
- Логирование и graceful shutdown.

---

## Быстрый старт

### 1. Клонирование репозитория

```sh
git clone git@git.platform.alem.school:ysyzdyko/marketflow.git
cd marketflow
```

### 2. Загрузка Docker-образов бирж

В проекте используются эмуляторы криптобирж для получения реальных данных. Для их загрузки используйте команду(не обязательно):

```sh
make load-images
```

Это автоматически загрузит необходимые образы для трех бирж (exchange1, exchange2, exchange3) в ваш Docker.

### 3. Запуск приложения и инфраструктуры

Для старта самого приложения, Redis, PostgreSQL и эмуляторов бирж используйте Docker Compose:

```sh
docker-compose up --build
```

Это:
- Соберет и запустит `marketflow`
- Поднимет Redis и PostgreSQL
- Запустит эмуляторы всех трех бирж на портах 40101, 40102, 40103

### 4. Конфигурация

Все параметры подключения к базам и биржам задаются в файле `config.env`. В нем указываются:
- параметры PostgreSQL (host, port, user, password, database)
- параметры Redis (host, port, password)
- параметры Server (port)
### 5. Использование программы
- Для удобства сделан полностью рабочий малый фронт
  ```
#### Переключение режима работы
- Для перехода в тестовый режим (генерация синтетических данных):
  ```
  POST /mode/test
  ```
- Для возврата в live режим (сбор с эмуляторов):
  ```
  POST /mode/live
  ```

#### Примеры API-запросов

- Получить последнюю цену для пары:
  ```
  GET /prices/latest/BTCUSDT
  ```
- Получить среднюю цену за 5 минут по бирже:
  ```
  GET /prices/average/exchange1/BTCUSDT?period=5m
  ```
- Проверить состояние системы:
  ```
  GET /health
  ```

---

## Архитектура

- **Hexagonal architecture**: четкое разделение на доменную логику, слой приложения и адаптеры (API, хранилище, кэш, биржи).
- **Concurrency**: используются fan-in, fan-out, worker pool для параллельной обработки данных.
- **Кэш**: Redis хранит последние цены для всех пар и бирж.
- **База**: PostgreSQL хранит минутные агрегированные значения (average, min, max).
- **API**: реализованы все необходимые эндпоинты для рыночных данных и управления режимом.

---

## Разработка и тестирование

- Запуск всех сервисов для локального тестирования:
  ```sh
  docker-compose up --build
  ```
- Остановка и удаление сервисов:
  ```sh
  docker-compose down
  ```

---

## Логирование и мониторинг

- Вся работа приложения логируется через кастомный логгер с уровнями `Info`, `Warning`, `Error`.
- Для graceful shutdown используется обработка сигналов SIGINT/SIGTERM.

---

## Контакты автора

- Email: [justerkanat@gmail.com](mailto:justerkanat@gmail.com)
- [LinkedIn](https://www.linkedin.com/in/yerkanbey/)

---
